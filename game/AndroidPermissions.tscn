[gd_scene load_steps=2 format=3 uid="uid://bsp6ld82gm87s"]

[sub_resource type="GDScript" id="GDScript_3yq00"]
script/source = "extends Node

func _ready():
	if OS.get_name() == \"Android\":
		print(\"ðŸ¤– Android device detected, version: \" + OS.get_version())
		await get_tree().create_timer(1.0).timeout
		check_and_request_permissions()

func check_and_request_permissions():
	print(\"=== Android Storage Check ===\")
	
	# ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÐ¼ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· OS (Godot 4.x)
	if OS.has_method(\"request_permissions\"):
		print(\"ðŸ” Requesting permissions via OS.request_permissions()\")
		OS.request_permissions()
		await get_tree().create_timer(0.5).timeout
	
	# Ð’ÑÐµÐ³Ð´Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿
	test_storage_access()

func test_storage_access() -> bool:
	print(\"--- Testing Storage Access ---\")
	
	var test_path = \"user://zpg_storage_test.tmp\"
	var success = false
	
	# ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»
	var file = FileAccess.open(test_path, FileAccess.WRITE)
	if file:
		file.store_string(\"ZPG Storage Test\")
		file.close()
		
		# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ Ñ„Ð°Ð¹Ð» ÑÐ¾Ð·Ð´Ð°Ð»ÑÑ
		if FileAccess.file_exists(test_path):
			print(\"âœ… Storage access: WORKING\")
			success = true
			# Ð§Ð¸ÑÑ‚Ð¸Ð¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
			DirAccess.remove_absolute(test_path)
		else:
			print(\"âŒ Storage access: FILE NOT CREATED\")
	else:
		print(\"âŒ Storage access: CANNOT WRITE\")
	
	print(\"-----------------------------\")
	return success

# ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð»Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²
func has_storage_permission() -> bool:
	return test_storage_access()
"

[node name="AndroidPermissions" type="Node2D"]
script = SubResource("GDScript_3yq00")
